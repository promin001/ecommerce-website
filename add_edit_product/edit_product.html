<!DOCTYPE html>
<html lang="en">
  <head>
    <title>E-Commerce</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="../style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css">
 <style>
  main {
            max-width: 600px;
            margin: 0 auto;
            margin-top: 150px;
        }
#product-form h1{
  text-align: center;
  color: black;
  font-weight: bold;
}
#product-form{
          margin-top: 20%;
        }
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
        }
        .form-group input{
            height: 40px;
            width: 250px;

        }

        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #product-form button {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transform: 0.2s ease;
        }

        #product-form button:hover {
            background-color: #555;
        }
        #product-form a {
            font-size: 15px;
            font-weight: bold;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    font-size: 15px;
    font-weight: bold;
    border: 1px solid #ddd;
    text-align: left;
}

th {
    background-color: #4CAF50;
    color: white;
}


.search-container {
    padding-left: 500px;
    text-align: center;
    width: 1000px;
    margin-bottom: 20px;
}

.search-input {
    width: 70%;
    padding: 10px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.search-button {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.search-button:hover {
    background-color: #45a049;
}
button {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #45a049;
}
.form-group select {
    height: 30px;
  width: 200px;
  border-radius: 5px;
  font-size: 14px;
  background-color: white;
  cursor: pointer;
}
#edit-product-form h2{
    text-align: center;
}
#product-table{
    background-color: white;
    text-align: center;
}
#product-table thead{
    font-size: 15px;
    font-weight: bold;
}

    </style>
  </head>
  <body>
    <header class="header">
      <div class="top-navbar-border">
        <div class="top-navbar">
          <a href="#">Become a Seller &nbsp &nbsp &nbsp</a>
          <a href="#">Donate &nbsp&nbsp&nbsp</a>
          <a href="#">Help and Support</a>
        <div class="top-nevber-app" >
          <a href="#">Download App</a>
        </div>
        </div>
      </div>
      <div class="navbar-border">
        <div class="navbar">
        <h2 class="logo"><a href="../index.html">Promin E-Commerce</a></h2>
        <ul class="links">
            <!--<div class="search-box">
              <form action="">
                <input type="search" id="search-input" placeholder="&nbsp &nbsp Search your Items">
                <a href="index1.html"> <button id="search" type="submit"><i class="fa fa-search"></i></button> 
              </form>
            </div> -->

            <div class="wrapper">
              <div id="search-container">
            <input type="text" id="searchInput" placeholder="Search by product name">
            <button id="searchButton">Search</button>
        </div>
          </div>
            <li><a href="../shop.html">Shop</a></li>
            <li>|</li>
          <li><a href="login.html">Login</a></li>
          <li>|</li>
          <li><a href="signup.html">Sign Up</a></li>
          <li>|</li>
          <div class="switch">
            <input id="language-toggle" class="check-toggle check-toggle-round-flat" type="checkbox">
            <label for="language-toggle"></label>
            <span class="on">BN</span>
            <span class="off">EN</span>
          </div>
          <li>|</li>       
           <div class="cart-icon" id="open-cart" onclick="openCart()"><i class="bi bi-cart"></i></div>
          <div class="popup" id="cart-popup">
    <div class="cart-content">
        <h2 style="color: black; text-align: center;">Your Cart</h2>
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Image</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="cart-items">
                <!-- Cart items will be displayed here -->
            </tbody>
        </table>
        <div style="color: black;" class="cart-total">Total: $<span id="cart-total">0.00</span></div>
        <button onclick="checkout()">Pay</button>
        <button onclick="closeCart()">Close</button>
    </div>
  </div>
        </ul>
      </div>
    </div>
    </header>
 <main>
    <form id="edit-product-form">
        <h2>Edit Product</h2>
        <div class="form-group">
            <label for="selected-product">Select Product:</label>
            <select id="selected-product" name="selected-product" required></select>
        </div>
        <div style="display: flex;">
        <div class="form-group">
            <label for="edit-name">Name:</label>
            <input type="text" id="edit-name" name="edit-name" required>
        </div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="form-group">
            <label for="edit-price">Price:</label>
            <input type="number" id="edit-price" name="edit-price" required>
        </div>
    </div>
    <div style="display: flex;">
        <div class="form-group">
            <label for="edit-color">Color:</label>
            <input type="text" id="edit-color" name="edit-color" required>
        </div>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="form-group">
            <label for="edit-photo">Photo:</label>
            <input type="file" id="edit-photo" name="edit-photo" accept="image/*">
        </div>
        </div>
        <div class="form-group">
            <label for="edit-details">Details:</label>
            <textarea id="edit-details" name="edit-details" rows="4" required></textarea>
        </div>
        <div class="form-group">
            <label for="edit-photo-preview">Existing Photo:</label>
            <img id="edit-photo-preview" src="" alt="Existing Photo" style="max-width: 100px; max-height: 100px;">
        </div>
        <button type="submit">Save Changes</button>
    </form>
</main>

    <h1 style="text-align: center;">Edit Products</h1>
    <div class="search-container">
        <input type="text" id="search-input" class="search-input" placeholder="Search by Product Name">
        <button type="button" id="search-button" class="search-button" onclick="filterProducts('')">Search</button>
    </div>

    <!-- Product Table -->
    <table id="product-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Details</th>
                <th>Color</th>
                <th>Photo</th>
                <th>Actions</th> 
            </tr>
        </thead>
        <tbody></tbody>
    </table>
<br><br><br><br><br><br>
    <footer class="section-p1" style="background-color: white;">
      <div class="col">
        <h2 class="logo"><a href="../index.html">Promin E-Commerce</a></h2><br>
        <h4>Contact Us</h4>
        <p><strong>Address: </strong> 1229 Kuratoli, kuril, Dhaka Bnagladesh</p>
        <p><strong>Phone: </strong> +8801791428394</p>
        <p><strong>Hosuse: </strong> 25/5 K, Kuratoli</p>
          <div class="follow">
            <h4>Follow Uc</h4>
              <div>
                <a href="#"><i class="bi bi-facebook"></i></a>
                <a href="#"><i class="bi bi-twitter"></i></a>
                <a href="#"><i class="bi bi-instagram"></i></a>
                <a href="#"><i class="bi bi-whatsapp"></i></a>
                <a href="#"><i class="bi bi-youtube"></i></a>
              </div>
          </div>
      </div>
      <div class="col">
        <h4>About</h4>
        <a href="#">About Us</a>
        <a href="#">Delivery Information</a>
        <a href="#">Privacy Policy</a>
        <var><a href="#">Terms & Condition</a>
          <a href="#">Contact Us</a></var>
      </div>

      <div class="col">
        <h4>My Account</h4>
        <a href="#">Sign in</a>
        <a href="#">View Cart</a>
        <a href="#">My Wishlist</a>
        <a href="#">Track My Order</a>
        <a href="#">Help</a>
      </div>

      <div class="col install">
        <h4> Install App</h4>
        <p> From App Store or Google Play Store</p>
        <div class="row">
          <img src="image/appstore.png">
          <img src="image/playstore.png">
        </div>
        <p>Secured Payment Method</p>
        <img src="image/payment.jpg" alt="">

    </footer>
  <div class="copyright" style="text-align: center; background-color: white;">
    <p> Â© 2021, Promin E-commerce - HTML CSS Ecommerce Template</p>
  </div>
    <script>
document.addEventListener('DOMContentLoaded', function () {
    const productTableBody = document.querySelector('#product-table tbody');
    const selectProduct = document.getElementById('selected-product');
    const editForm = document.getElementById('edit-product-form');
    const searchInput = document.getElementById('search-input');

    // Fetch and populate product table
    function fetchProducts() {
        fetch('get_products.php?' + new Date().getTime())
            .then(response => response.json())
            .then(products => {
                // Populate product table and select options
                productTableBody.innerHTML = ''; // Clear existing rows
                products.forEach(product => {
                    const row = productTableBody.insertRow();
                    const cellName = row.insertCell(0);
                    const cellPrice = row.insertCell(1);
                    const cellDetails = row.insertCell(2);
                    const cellColor = row.insertCell(3);
                    const cellPhoto = row.insertCell(4);
                    const cellActions = row.insertCell(5);

                    cellName.textContent = product.name;
                    cellPrice.textContent = product.price;
                    cellDetails.textContent = product.details;
                    cellColor.textContent = product.color;
                    cellPhoto.innerHTML = `<img src="${product.photo}" alt="${product.name}" style="max-width: 50px; max-height: 50px;">`;

                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.addEventListener('click', function () {
                        selectProduct.value = product.name;
                        document.getElementById('edit-name').value = product.name;
                        document.getElementById('edit-price').value = product.price;
                        document.getElementById('edit-details').value = product.details;
                        document.getElementById('edit-color').value = product.color;
                        document.getElementById('edit-photo-preview').src = product.photo;
                    }); 

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', function (event) {
                        event.preventDefault();
                        deleteProduct(product.name, row);
                    });

                    cellActions.appendChild(editButton); 
                    cellActions.appendChild(deleteButton);

                    const option = document.createElement('option');
                    option.value = product.name;
                    option.textContent = product.name;
                    selectProduct.appendChild(option);
                });
            })
            .catch(error => console.error(error));
    }

    fetchProducts(); // Initial fetch when the page loads

    // Handle file input change for photo preview
    document.getElementById('edit-photo').addEventListener('change', function (event) {
        if (event.target.files.length > 0) {
            document.getElementById('edit-photo-preview').src = URL.createObjectURL(event.target.files[0]);
        }
    });

    // Handle form submission
    editForm.addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission behavior
        const editFormData = new FormData(editForm);

        if (!editFormData.get('edit-photo')) {
            editFormData.delete('edit-photo');
        }

        fetch('edit_product.php', {
            method: 'POST',
            body: editFormData
        })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                editForm.reset();
                fetchProducts(); // Fetch and update the table with fresh data
            })
            .catch(error => console.error(error));
    });

    // Automatic search as the user types
    searchInput.addEventListener('input', function () {
        const searchTerm = searchInput.value.toLowerCase();

        Array.from(productTableBody.rows).forEach(row => {
            const productName = row.cells[0].textContent.toLowerCase();
            row.style.display = productName.includes(searchTerm) ? '' : 'none';
        });
    });

    // Function to delete a product
    function deleteProduct(productName, row) {
        const confirmed = confirm(`Are you sure you want to delete the product: ${productName}?`);

        if (confirmed) {
            fetch('delete_product.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'selected-product=' + encodeURIComponent(productName),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        row.remove(); // Remove the row from the table on successful deletion
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => console.error(error));
        }
    }
});

    </script>
    
</body>
</html>
